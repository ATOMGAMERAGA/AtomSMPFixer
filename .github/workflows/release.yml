name: Build and Release

on:
  push:
    tags:
      - 'v*.*.*'  # v1.0.0, v1.0.1, v2.0.0 gibi tag'lerde tetiklenir

permissions:
  contents: write

jobs:
  build-and-release:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout kod
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Java 21 kurulumu
        uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'temurin'
          cache: 'maven'

      - name: Versiyon bilgisini al
        id: version
        run: |
          # Tag'den version numarasÄ±nÄ± al (v1.0.0 -> 1.0.0)
          VERSION=${GITHUB_REF#refs/tags/v}
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          echo "tag=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT
          echo "Version: $VERSION"

      - name: pom.xml versiyonunu gÃ¼ncelle
        run: |
          VERSION=${{ steps.version.outputs.version }}
          mvn versions:set -DnewVersion=$VERSION -DgenerateBackupPoms=false

      - name: Maven ile build
        run: mvn clean package -DskipTests

      - name: JAR dosyasÄ±nÄ± doÄŸrula
        run: |
          if [ ! -f target/AtomSMPFixer-${{ steps.version.outputs.version }}.jar ]; then
            echo "âŒ JAR dosyasÄ± bulunamadÄ±!"
            ls -la target/
            exit 1
          fi
          echo "âœ… JAR dosyasÄ± baÅŸarÄ±yla oluÅŸturuldu"
          ls -lh target/AtomSMPFixer-${{ steps.version.outputs.version }}.jar

      - name: SHA256 checksum oluÅŸtur
        run: |
          cd target
          sha256sum AtomSMPFixer-${{ steps.version.outputs.version }}.jar > AtomSMPFixer-${{ steps.version.outputs.version }}.jar.sha256
          cat AtomSMPFixer-${{ steps.version.outputs.version }}.jar.sha256

      - name: Release notes oluÅŸtur
        id: release_notes
        run: |
          cat > release_notes.md << 'EOF'
          # ğŸ¯ AtomSMPFixer ${{ steps.version.outputs.tag }}

          ## ğŸ“¦ Ä°ndirme

          **Paper 1.21.4** iÃ§in geliÅŸtirilmiÅŸ kapsamlÄ± exploit fixer plugin'i.

          ### Gereksinimler
          - â˜• Java 21+
          - ğŸ“„ Paper 1.21.4
          - ğŸ“¡ PacketEvents 2.6.0+

          ### Kurulum
          1. `AtomSMPFixer-${{ steps.version.outputs.version }}.jar` dosyasÄ±nÄ± indirin
          2. Sunucunuzun `plugins/` klasÃ¶rÃ¼ne kopyalayÄ±n
          3. [PacketEvents](https://modrinth.com/plugin/packetevents) plugin'ini kurun
          4. Sunucuyu baÅŸlatÄ±n

          ## âœ¨ Ã–zellikler

          - ğŸ›¡ï¸ **21 Exploit Fixer ModÃ¼lÃ¼**
          - ğŸ“Š **GeliÅŸmiÅŸ Paket KontrolÃ¼** (PacketEvents)
          - ğŸš€ **Ultra-PerformanslÄ±** (Thread-safe, async)
          - ğŸ‡¹ğŸ‡· **TÃ¼rkÃ§e ArayÃ¼z** (MiniMessage desteÄŸi)
          - ğŸ“ **Async Log Sistemi**
          - âš™ï¸ **ModÃ¼l BazlÄ± KonfigÃ¼rasyon**
          - ğŸ”„ **Hot-Reload DesteÄŸi**

          ## ğŸ›¡ï¸ ModÃ¼ller

          âœ… TooManyBooks (Chunk Crasher/Dupe)
          âœ… PacketDelay (Bundle Dupe)
          âœ… PacketExploit (Netty Crasher)
          âœ… CustomPayload
          âœ… CommandsCrash
          âœ… CreativeItems (World Crasher)
          âœ… SignCrasher (World Crasher)
          âœ… LecternCrasher
          âœ… MapLabelCrasher
          âœ… InvalidSlot
          âœ… NBTCrasher
          âœ… BookCrasher
          âœ… CowDuplication
          âœ… DispenserCrasher
          âœ… OfflinePacket
          âœ… InventoryDuplication
          âœ… MuleDuplication
          âœ… PortalBreak
          âœ… BundleDuplication
          âœ… NormalizeCoordinates
          âœ… FrameCrash

          ## ğŸ® Komutlar

          ```
          /atomfix reload       - Config'i yeniden yÃ¼kle
          /atomfix status       - Durum ve istatistikler
          /atomfix toggle <mod> - ModÃ¼l aÃ§/kapa
          /atomfix info         - Plugin bilgileri
          ```

          ## ğŸ” Ä°zinler

          - `atomsmpfixer.admin` - TÃ¼m komutlara eriÅŸim
          - `atomsmpfixer.bypass` - Exploit kontrollerini atla
          - `atomsmpfixer.reload` - Config reload
          - `atomsmpfixer.notify` - Exploit bildirimleri

          ## ğŸ“‹ Checksum

          SHA256 checksum dosyasÄ± ile doÄŸrulama yapabilirsiniz.

          ## ğŸ› Destek

          Hata bildirimi veya Ã¶neriler iÃ§in [Issues](https://github.com/ATOMGAMERAGA/AtomSMPFixer/issues) sayfasÄ±nÄ± kullanÄ±n.

          ---

          **GeliÅŸtirici:** AtomSMP
          **Lisans:** TÃ¼m haklarÄ± saklÄ±dÄ±r
          EOF

          echo "Release notes oluÅŸturuldu"

      - name: GitHub Release oluÅŸtur
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ steps.version.outputs.tag }}
          name: AtomSMPFixer ${{ steps.version.outputs.tag }}
          body_path: release_notes.md
          draft: false
          prerelease: false
          make_latest: true
          files: |
            target/AtomSMPFixer-${{ steps.version.outputs.version }}.jar
            target/AtomSMPFixer-${{ steps.version.outputs.version }}.jar.sha256
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Release baÅŸarÄ±lÄ± mesajÄ±
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ… Release baÅŸarÄ±yla oluÅŸturuldu!"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ“¦ Version: ${{ steps.version.outputs.version }}"
          echo "ğŸ·ï¸ Tag: ${{ steps.version.outputs.tag }}"
          echo "ğŸ”— URL: https://github.com/${{ github.repository }}/releases/tag/${{ steps.version.outputs.tag }}"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
